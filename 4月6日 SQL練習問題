-- 1/ 各グループの中でFIFAランクが最も高い国と低い国のランキング番号を表示してください。
select
  group_name as ”グルブ”
  , min(ranking) as "ランキングランキング最上位"
  , max(ranking) as "ランキングランキング最下位" 
from
  countries 
group by
  group_name 
order by
  group_name; 

-- 2/ 全ゴールキーパーの平均身長、平均体重を表示してください。
select
  round(avg(height), 4) as "平均身長"
  , round(avg(weight), 4) as "平均体重" 
from
  players 
where
  position = 'GK'; 

-- 3/ 各国の平均身長を高い方から順に表示してください。ただし、FROM句はcountriesテーブルとしてください。
select
  countries.name as "国名"
  , round(avg(players.height), 4) as "平均身長" 
from
  countries 
  inner join players 
    on countries.id = players.country_id 
group by
  countries.name 
order by
  round(avg(players.height), 4) desc; 

-- 4/ 各国の平均身長を高い方から順に表示してください。ただし、FROM句はplayersテーブルとして、テーブル結合を使わず副問合せを用いてください。
select
  ( 
    select
      countries.name 
    from
      countries 
    where
      countries.id = players.country_id
  ) as "国名"
  , round(avg(players.height), 4) as "平均身長" 
from
  players 
group by
  players.country_id 
order by
  round(avg(players.height), 4) desc; 

-- 5/ キックオフ日時と対戦国の国名をキックオフ日時の早いものから順に表示してください。
select
  to_char(pairings.kickoff, 'yyyy-mm-dd') as "キックオフ"
  , mc.name as "国名1"
  , em.name as "国名2" 
from
  pairings 
  inner join countries mc 
    on mc.id = pairings.my_country_id 
  inner join countries em 
    on em.id = pairings.enemy_country_id 
order by
  pairings.kickoff; 

-- 6/ すべての選手を対象として選手ごとの得点ランキングを表示してください。（SELECT句で副問合せを使うこと）
select
  players.name as "名前"
  , players.position as "ポジション"
  , players.club as "所属クラブ"
  , ( 
    select
      count(id) 
    from
      goals 
    where
      goals.player_id = players.id
  ) as "ゴール数" 
from
  players 
order by
  ゴール数 desc; 

-- 7/ すべての選手を対象として選手ごとの得点ランキングを表示してください。（テーブル結合を使うこと）
select
  players.name as "名前"
  , players.position as "ポジション"
  , players.club as "所属クラブ"
  , count(goals.id) as "ゴール数" 
from
  players 
  inner join goals 
    on players.id = goals.player_id 
group by
  players.name
  , players.position
  , players.club 
order by
  ゴール数 desc; 

-- 8/ 各ポジションごとの総得点を表示してください。
select
  players.position as "ポジション"
  , count(goals.goal_time) as "ゴール数" 
from
  players 
  inner join goals 
    on players.id = goals.player_id 
group by
  players.position 
order by
  ゴール数 desc; 

-- 9/ ワールドカップ開催当時（2014-06-13）の年齢をプレイヤー毎に表示する。
select to_char(birth, 'yyyy-mm-dd'),   date_part('year', age(to_char(birth, 'yyyy-mm-dd')::date)) as age, name, position from players order by age desc; 

-- 10/ オウンゴールの回数を表示する
select count(goal_time) as "COUNT(goals.goal_time)" from goals where player_id is null;
